<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Merger</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 40px; }
    #drop-zone {
      border: 2px dashed #ccc;
      padding: 40px;
      background: #f9f9f9;
      margin-bottom: 20px;
      cursor: pointer;
    }
    #drop-zone.hover { background: #e0ffe0; }
  </style>
</head>
<body>

  <h1>Drop Images and PDF to Merge</h1>
  <div id="drop-zone">Drop your files here (1 PDF + images)</div>
  <button id="merge-btn" disabled>Merge and Download PDF</button>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

  <script>
    const dropZone = document.getElementById('drop-zone');
    const mergeBtn = document.getElementById('merge-btn');
    let imageFiles = [];
    let pdfFile = null;

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('hover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('hover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('hover');
      const files = Array.from(e.dataTransfer.files);

      imageFiles = [];
      pdfFile = null;

      files.forEach(file => {
        if (file.type === 'application/pdf' && !pdfFile) {
          pdfFile = file;
        } else if (file.type.startsWith('image/')) {
          imageFiles.push(file);
        }
      });

      if (pdfFile && imageFiles.length > 0) {
        mergeBtn.disabled = false;
        alert("Ready to merge PDF and " + imageFiles.length + " image(s).");
      } else {
        alert("Please drop one PDF and at least one image.");
        mergeBtn.disabled = true;
      }
    });

    mergeBtn.addEventListener('click', async () => {
      const existingPdfBytes = await pdfFile.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
      const imagePromises = imageFiles.map(f => f.arrayBuffer());

      for (const buffer of await Promise.all(imagePromises)) {
        const imgType = new Uint8Array(buffer)[0] === 0xFF ? 'jpg' : 'png';
        const image = imgType === 'jpg'
          ? await pdfDoc.embedJpg(buffer)
          : await pdfDoc.embedPng(buffer);
        const page = pdfDoc.addPage();
        const { width, height } = page.getSize();
        const imgDims = image.scaleToFit(width, height);
        page.drawImage(image, {
          x: (width - imgDims.width) / 2,
          y: (height - imgDims.height) / 2,
          width: imgDims.width,
          height: imgDims.height,
        });
      }

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'merged.pdf';
      link.click();
    });
  </script>
</body>
</html>
