document.addEventListener("DOMContentLoaded", function() {
    const tableBody = document.getElementById("table-body");
    const addRowButton = document.getElementById("add-row");

    // Fetch the saved data from the server when the page loads
    fetchTableData();

    // Add a new row to the table when the "Add Row" button is clicked
    addRowButton.addEventListener("click", function() {
        addRow();
        saveTableData();
    });

    // Function to create a new row with editable cells
    function addRow() {
        const newRow = document.createElement("tr");

        for (let i = 0; i < 10; i++) {
            const newCell = document.createElement("td");
            const input = document.createElement("input");
            input.type = "text";
            newCell.appendChild(input);
            newRow.appendChild(newCell);
        }

        tableBody.appendChild(newRow);
    }

    // Function to save the current table data to the server
    function saveTableData() {
        const rows = tableBody.getElementsByTagName("tr");
        const tableData = [];

        for (let row of rows) {
            const rowData = [];
            const cells = row.getElementsByTagName("td");

            for (let cell of cells) {
                const input = cell.querySelector("input");
                rowData.push(input ? input.value : "");
            }

            tableData.push(rowData);
        }

        // Send data to the server
        fetch("/api/save-data", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ tableData })
        });
    }

    // Function to fetch the table data from the server
    function fetchTableData() {
        fetch("/api/get-data")
            .then(response => response.json())
            .then(data => {
                for (let rowData of data) {
                    const newRow = document.createElement("tr");

                    for (let dataItem of rowData) {
                        const newCell = document.createElement("td");
                        const input = document.createElement("input");
                        input.type = "text";
                        input.value = dataItem;
                        newCell.appendChild(input);
                        newRow.appendChild(newCell);
                    }

                    tableBody.appendChild(newRow);
                }
            });
    }
});
